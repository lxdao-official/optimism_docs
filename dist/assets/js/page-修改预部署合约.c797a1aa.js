(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{647:function(s,a,e){"use strict";e.r(a);var t=e(2),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("🚧 OP Stack Hacks 是一些可以使用 OP Stack 进行的操作，目前并不适用于生产环境")]),s._v(" "),e("p",[s._v("OP Stack Hacks 不适合新手。您将无法获得针对 OP Stack Hacks 的重要开发者支持 - 请准备好亲自动手并在没有支持的情况下工作。")])]),s._v(" "),e("p",[s._v("OP Stack 区块链有许多"),e("a",{attrs:{href:"https://github.com/ethereum-optimism/optimism/blob/129032f15b76b0d2a940443a39433de931a97a44/packages/contracts-bedrock/src/constants.ts",target:"_blank",rel:"noopener noreferrer"}},[s._v("预部署合约"),e("OutboundLink")],1),s._v("，提供重要的功能。\n其中大部分合约都是代理合约，可以使用在网络初始部署时配置的 "),e("code",[s._v("proxyAdminOwner")]),s._v(" 进行升级。")]),s._v(" "),e("p",[s._v("预部署合约由名为 "),e("a",{attrs:{href:"https://github.com/ethereum-optimism/optimism/blob/129032f15b76b0d2a940443a39433de931a97a44/packages/contracts-bedrock/contracts/universal/ProxyAdmin.sol",target:"_blank",rel:"noopener noreferrer"}},[e("code",[s._v("ProxyAdmin")]),e("OutboundLink")],1),s._v(" 的合约控制，其地址为 "),e("code",[s._v("0x4200000000000000000000000000000000000018")]),s._v("。\n要调用的函数是 "),e("a",{attrs:{href:"https://github.com/ethereum-optimism/optimism/blob/129032f15b76b0d2a940443a39433de931a97a44/packages/contracts-bedrock/contracts/universal/ProxyAdmin.sol#L205-L229",target:"_blank",rel:"noopener noreferrer"}},[e("code",[s._v("upgrade(address,address)")]),e("OutboundLink")],1),s._v("。\n第一个参数是要升级的代理合约，第二个参数是新实现的地址。")]),s._v(" "),e("p",[s._v("例如，旧版的 "),e("code",[s._v("L1BlockNumber")]),s._v(" 合约位于 "),e("code",[s._v("0x420...013")]),s._v("。\n为了禁用此功能，我们将实现设置为 "),e("code",[s._v("0x00...00")]),s._v("。\n我们使用 "),e("a",{attrs:{href:"https://book.getfoundry.sh/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Foundry"),e("OutboundLink")],1),s._v(" 命令 "),e("code",[s._v("cast")]),s._v(" 来完成此操作。")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("我们需要几个常量。")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("在您的终端中将这些地址设置为变量。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("L1BLOCKNUM")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0x4200000000000000000000000000000000000013\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PROXY_ADMIN")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0x4200000000000000000000000000000000000018\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ZERO_ADDR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0x0000000000000000000000000000000000000000\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("将 "),e("code",[s._v("PRIVKEY")]),s._v(" 设置为您的 ADMIN 账户的私钥。")])]),s._v(" "),e("li",[e("p",[s._v("设置 "),e("code",[s._v("ETH_RPC_URL")]),s._v("。如果您在运行区块链的计算机上，请使用以下命令。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETH_RPC_URL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://localhost:8545\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])])]),s._v(" "),e("li",[e("p",[s._v("验证 "),e("code",[s._v("L1BlockNumber")]),s._v(" 正常工作。\n查看调用合约时是否返回一个区块号，十二秒后是否返回下一个区块号（L1上的区块时间为十二秒）。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("cast call "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$L1BLOCKNUM")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'number()'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cast --to-dec\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" cast call "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$L1BLOCKNUM")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'number()'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cast --to-dec\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("获取合约的当前实现。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("L1BLOCKNUM_IMPLEMENTATION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("cast call $L1BLOCKNUM "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"implementation()"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/000000000000000000000000//'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$L1BLOCKNUM_IMPLEMENTATION")]),s._v(" \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("将实现更改为零地址")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("cast send --private-key "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRIVKEY")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROXY_ADMIN")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upgrade(address,address)"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$L1BLOCKNUM")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ZERO_ADDR")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("查看实现地址是否为零，并且调用失败。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("cast call "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$L1BLOCKNUM")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'implementation()'")]),s._v("\ncast call "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$L1BLOCKNUM")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'number()'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("将预部署合约修复为先前的实现，并验证其是否正常工作。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("cast send --private-key "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRIVKEY")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROXY_ADMIN")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upgrade(address,address)"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$L1BLOCKNUM")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$L1BLOCKNUM_IMPLEMENTATION")]),s._v("\ncast call "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$L1BLOCKNUM")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'number()'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cast --to-dec\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])])])])}),[],!1,null,null,null);a.default=r.exports}}]);